<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ì„¤ì • - CaseNetAI</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            padding: 20px;
        }

        .setup-container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-header h1 {
            color: #1e40af;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .setup-header p {
            color: #64748b;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #334155;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-create {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .btn-create:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-create:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .master-password-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .account-info {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 13px;
            line-height: 1.6;
        }

        .account-info strong {
            color: #1e40af;
        }

        .hide {
            display: none;
        }

        .loading {
            text-align: center;
            color: #64748b;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="setup-container">
        <div class="setup-header">
            <h1>ğŸ” ê´€ë¦¬ì ê³„ì • ì„¤ì •</h1>
            <p>CaseNetAI ì‹œìŠ¤í…œ ê´€ë¦¬ì ì „ìš© í˜ì´ì§€</p>
        </div>

        <!-- ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
        <div id="masterPasswordSection" class="master-password-section">
            <div class="form-group">
                <label>ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="masterPassword" placeholder="ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <button onclick="verifyMasterPassword()" class="btn-create">í™•ì¸</button>
        </div>

        <!-- ê³„ì • ìƒì„± í¼ -->
        <div id="setupForm" class="hide">
            <div id="alertContainer"></div>

            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" id="email" placeholder="admin@casenetai.kr" required>
            </div>

            <div class="form-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" placeholder="ìµœì†Œ 8ì ì´ìƒ" required>
            </div>

            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" id="name" placeholder="í™ê¸¸ë™" required>
            </div>

            <div class="form-group">
                <label>ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="phone" placeholder="010-1234-5678">
            </div>

            <div class="form-group">
                <label>ê¶Œí•œ</label>
                <select id="role">
                    <option value="system_admin">ì‹œìŠ¤í…œ ê´€ë¦¬ì (system_admin)</option>
                    <option value="org_admin">ì¡°ì§ ê´€ë¦¬ì (org_admin)</option>
                    <option value="user">ì¼ë°˜ ì‚¬ìš©ì (user)</option>
                </select>
            </div>

            <div class="form-group">
                <label>ì´ˆê¸° í¬ë ˆë”§ (ì›)</label>
                <input type="number" id="credits" value="10000000" min="0" step="1000">
            </div>

            <button onclick="createAccount()" class="btn-create" id="createBtn">
                ê³„ì • ìƒì„±
            </button>

            <div id="accountInfo" class="account-info hide"></div>
        </div>
    </div>

    <script>
        // ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ (í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” í•˜ë“œì½”ë”©)
        const MASTER_PASSWORD = 'CaseNetAI2026!@#';

        function verifyMasterPassword() {
            const input = document.getElementById('masterPassword').value;
            
            if (input === MASTER_PASSWORD) {
                document.getElementById('masterPasswordSection').classList.add('hide');
                document.getElementById('setupForm').classList.remove('hide');
                showAlert('ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì„±ê³µ!', 'success');
            } else {
                showAlert('ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
            }
        }

        async function createAccount() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const role = document.getElementById('role').value;
            const credits = parseInt(document.getElementById('credits').value);

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!email || !password || !name) {
                showAlert('ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ì´ë¦„ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            if (password.length < 8) {
                showAlert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const createBtn = document.getElementById('createBtn');
            createBtn.disabled = true;
            createBtn.textContent = 'ìƒì„± ì¤‘...';

            try {
                // ê´€ë¦¬ì ê³„ì • ìƒì„± (ì—­í•  ë° í¬ë ˆë”§ ìë™ ì„¤ì •)
                const registerResponse = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        name,
                        phone: phone || null,
                        masterPassword: MASTER_PASSWORD,  // ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸
                        role: role,                        // ì—­í•  ì§€ì •
                        credits: credits                   // í¬ë ˆë”§ ì§€ì •
                    })
                });

                const registerData = await registerResponse.json();

                if (!registerResponse.ok) {
                    throw new Error(registerData.error || 'ê³„ì • ìƒì„± ì‹¤íŒ¨');
                }

                showAlert(`âœ… ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');

                // ê³„ì • ì •ë³´ í‘œì‹œ
                const accountInfo = document.getElementById('accountInfo');
                accountInfo.innerHTML = `
                    <strong>âœ… ìƒì„± ì™„ë£Œ!</strong><br>
                    <br>
                    ğŸ“§ <strong>ì´ë©”ì¼:</strong> ${email}<br>
                    ğŸ”‘ <strong>ë¹„ë°€ë²ˆí˜¸:</strong> ${password}<br>
                    ğŸ‘¤ <strong>ì´ë¦„:</strong> ${name}<br>
                    ${phone ? `ğŸ“± <strong>ì „í™”ë²ˆí˜¸:</strong> ${phone}<br>` : ''}
                    ğŸ­ <strong>ê¶Œí•œ:</strong> ${role}<br>
                    ğŸ’° <strong>í¬ë ˆë”§:</strong> ${credits.toLocaleString()}ì›<br>
                    <br>
                    âš ï¸ <strong>ì´ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ì„¸ìš”!</strong><br>
                    <br>
                    ğŸ”— <a href="/login.html" style="color: #1e40af; text-decoration: underline;">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™</a>
                `;
                accountInfo.classList.remove('hide');

                // í¼ ì´ˆê¸°í™”
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                document.getElementById('name').value = '';
                document.getElementById('phone').value = '';

            } catch (error) {
                showAlert(error.message, 'error');
            } finally {
                createBtn.disabled = false;
                createBtn.textContent = 'ê³„ì • ìƒì„±';
            }
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;

            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Enter í‚¤ ì§€ì›
        document.getElementById('masterPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                verifyMasterPassword();
            }
        });
    </script>
</body>
</html>
